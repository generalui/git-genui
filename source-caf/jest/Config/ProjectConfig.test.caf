import &StandardImport
import Config

mockFs = require :@art-suite/mock-fs

projectFolder = :testProject

initialFiles =
  [projectFolder]:
    .git: config: "" [core]

global.afterAll ->
  mockFs.restore()

chainedTest "initialize mock fs" ->
  mockFs initialFiles
  process.chdir projectFolder
  new ProjectConfig

.tapTest
  "load" (projectConfig) ->
    projectConfig.init()

  "load doesn't vivify" ->
    assert.eq
      mockFs.getTree()
      initialFiles

  "projectConfig.setConfigProperty :a :b" (projectConfig) ->
    projectConfig.setConfigProperty :a :b

  "setConfigProperty should automatically save" ->
    assert.eq
      JSON.parse mockFs.getTree()[projectFolder][projectConfig.configBasename]
      a: :b
