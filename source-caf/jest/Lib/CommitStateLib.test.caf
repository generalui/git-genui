import &ArtStandardLib, &source, &source.Git

global.beforeAll ->
  Config.load()

test 'getCommitComment' ->
  expect getCommitComment {}
  .toMatch
    /// git-genui .* v \d+\. \d+\. \d+

test 'getCommitComment' ->
  getInitialCommitState quiet: true
  .then (initialState) ->
    initialState.message = "my-commit-message"
    state = merge initialState,
      generatedCommitMessage: getGitCommitMessage initialState
      commit:                 "abc123"

    expect getCommitComment state

    .toMatch
      ///
        #{escapeRegExp state.storyState}
        (.|\n)*#{escapeRegExp state.commit}
        (.|\n)*#{escapeRegExp state.status.current}
        (.|\n)*#{escapeRegExp state.remote.refs.fetch}
        (.|\n)* #{escapeRegExp state.generatedCommitMessage}
        (.|\n)*git-genui
        (.|\n)* v \d+\. \d+\. \d+
